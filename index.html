<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Conar Friseur</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" />

<style>
:root{
  --page-bg:#0b0c10;
  --chat-bg:#14161a;
  --chat-border:rgba(255,255,255,.14);
  --bubble:#2a2d33;
  --bubble-border:rgba(255,255,255,.16);
  --text:#fff;
  --muted:rgba(255,255,255,.6);
  --input-bg:#1a1c20;
  --shadow:0 30px 80px rgba(0,0,0,.75);
  --gap:18px;
  --chat-width:min(30vw,420px);
  --chat-height:min(78vh,720px);
}

body{
  margin:0;
  min-height:100vh;
  background:var(--page-bg);
  color:#fff;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}

/* ================= SELECTION OVERLAY ================= */

#chat-select{
  position:fixed;
  right:var(--gap);
  bottom:var(--gap);
  width:var(--chat-width);
  height:var(--chat-height);
  background:var(--chat-bg);
  border:1px solid var(--chat-border);
  border-radius:18px;
  box-shadow:var(--shadow);
  z-index:99999;
  display:flex;
  flex-direction:column;
}

#chat-select header{
  padding:16px;
  border-bottom:1px solid var(--chat-border);
  font-size:14px;
  color:var(--muted);
}

#chat-select main{
  flex:1;
  display:grid;
  place-items:center;
  gap:16px;
}

.choice{
  width:80%;
  padding:18px;
  text-align:center;
  background:var(--bubble);
  border:1px solid var(--bubble-border);
  border-radius:14px;
  cursor:pointer;
  font-size:15px;
}

.choice:hover{ filter:brightness(1.1); }

/* ================= CHAT OVERRIDES ================= */

#n8n-chat .chat-window-wrapper{
  position:fixed !important;
  right:var(--gap)!important;
  bottom:var(--gap)!important;
  z-index:99999!important;
}

#n8n-chat .chat-window{
  width:var(--chat-width)!important;
  height:var(--chat-height)!important;
  background:var(--chat-bg)!important;
  border-radius:18px!important;
  border:1px solid var(--chat-border)!important;
  box-shadow:var(--shadow)!important;
}

#n8n-chat .chat-header{ display:none!important; }

#n8n-chat .chat-message{
  background:var(--bubble)!important;
  border:1px solid var(--bubble-border)!important;
  border-radius:14px!important;
  font-size:13px!important;
}

#n8n-chat .chat-window-toggle{
  position:fixed!important;
  right:var(--gap)!important;
  bottom:var(--gap)!important;
  width:56px!important;
  height:56px!important;
  border-radius:999px!important;
  background:var(--input-bg)!important;
  border:1px solid rgba(255,255,255,.25)!important;
  box-shadow:var(--shadow)!important;
}

#n8n-chat .chat-window-toggle svg{ display:none!important; }
#n8n-chat .chat-window-toggle::after{
  content:"üíà";
  display:grid;
  place-items:center;
  height:100%;
  font-size:20px;
}

/* BACK ARROW */
#back-btn{
  position:absolute;
  top:12px;
  left:12px;
  cursor:pointer;
  font-size:18px;
  color:var(--muted);
}
</style>
</head>

<body>

<!-- SELECTION -->
<div id="chat-select">
  <header>
    üëã Willkommen bei Conar Friseur  
    <br>W√§hle, wie ich dir helfen soll
  </header>
  <main>
    <div class="choice" data-mode="info">‚ÑπÔ∏è Infos</div>
    <div class="choice" data-mode="jason">‚úÇÔ∏è Termin bei Jason</div>
    <div class="choice" data-mode="elina">‚úÇÔ∏è Termin bei Elina</div>
  </main>
</div>

<script type="module">
import { createChat } from "https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js";

let chatInstance = null;

const startChat = (mode) => {
  document.getElementById("chat-select").style.display = "none";

  chatInstance = createChat({
    webhookUrl: `https://conner1005.app.n8n.cloud/webhook-test/conar-chat?mode=${mode}`,
    mode:"window",
    openOnLoad:true,
    initialMessages:[
      mode==="info"  ? "‚ÑπÔ∏è Ich gebe dir Infos zu Conar Friseur üòä"
    : mode==="jason"? "‚úÇÔ∏è Hi, ich bin Jason. Lass uns deinen Termin planen üòä"
    :                "‚úÇÔ∏è Hi, ich bin Elina. Ich k√ºmmere mich um deinen Termin üòä"
    ]
  });

  setTimeout(addBackButton,300);
};

const addBackButton = () => {
  if(document.getElementById("back-btn")) return;
  const w = document.querySelector("#n8n-chat .chat-window");
  if(!w) return;

  const btn = document.createElement("div");
  btn.id = "back-btn";
  btn.innerHTML = "‚Üê";
  btn.onclick = () => {
    document.getElementById("chat-select").style.display = "flex";
    document.querySelector("#n8n-chat")?.remove();
  };
  w.appendChild(btn);
};

document.querySelectorAll(".choice").forEach(c=>{
  c.onclick = () => startChat(c.dataset.mode);
});
</script>
</body>
</html>
